{% extends 'base.html' %}
{% block content %}
<div class="container">
    <div class="band-detail">
        <h2>{{ band.name }}</h2>
        <p>{{ band.description }}</p>
        <p><strong>GENRE | </strong> {{ band.genre }}</p>

        <div class="like-section">
            <button id="like-button" class="heart-btn {% if liked %}liked{% endif %}">
                <span id="heart-symbol">{% if liked %}♥{% else %}♡{% endif %}</span>
                <span id="likes-count" class="like-count">{{ likes_count }}</span>
            </button>
        </div>
        <h3 class="section-title">MEMBER</h3>
        <ul>
            {% for member in members %}
                <li>{{ member.name }} ({{ member.role }})</li>
            {% empty %}
                <li>멤버 정보가 없습니다.</li>
            {% endfor %}
        </ul>

        <h3 class="section-title">SONG LIST</h3>
        <ul>
            {% for song in songs %}
                <li>
                    {{ song.title }}
                    {% if song.url %}
                        - <a href="{{ song.url }}" target="_blank">PLAYLIST</a>
                    {% endif %}
                </li>
            {% empty %}
                <li>등록된 노래가 없습니다.</li>
            {% endfor %}
        </ul>

        <h3 class="section-title">COMMENT</h3>
        <ul class="comment-list">
            {% for comment in comments %}
                <li>{{ comment.content }} <br><small>{{ comment.created_at|date:"Y-m-d H:i" }}</small></li>
            {% empty %}
                <li>댓글이 없습니다.</li>
            {% endfor %}
        </ul>

        <form method="post" class="comment-form">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">등록</button>
        </form>
    </div>
</div>

<script>
const likeBtn = document.getElementById("like-button");
const heartSymbol = document.getElementById("heart-symbol");
const likesCount = document.getElementById("likes-count");

likeBtn.addEventListener("click", function() {
    fetch("{% url 'like_band' band.id %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "X-Requested-With": "XMLHttpRequest",
        }
    })
    .then(res => res.json())
    .then(data => {
        likesCount.textContent = data.likes_count; // 숫자 갱신
        if(data.liked){
            likeBtn.classList.add("liked");   // 빨간색 적용
            heartSymbol.textContent = "♥";    // 하트 변경
        } else {
            likeBtn.classList.remove("liked"); 
            heartSymbol.textContent = "♡";
        }
    });
});
</script>
{% endblock %}
